# 八字排盘 H5 应用

这是一个基于 Nuxt3、Vue3、UnoCSS 和 Prisma 的移动端优先的八字排盘 H5 应用。

## 功能

- 用户输入公历生日时辰，获取八字排盘结果。
- 展示四柱、十神、藏干、大运、流年等信息。
- 将每次排盘结果存入 SQLite 数据库。
- 支持通过唯一 ID 分享和回查历史排盘结果。

## 技术栈

- **前端**: Nuxt3 + Vue3 + Pinia + UnoCSS
- **后端**: Nuxt3 Server API
- **数据库**: Prisma + SQLite
- **构建工具**: pnpm

## 开发日志

### 2025-08-20 (Bug Fix)

- **修复**: 解决了注册时因数据库未同步 `User` 表而导致的 `The table main.User does not exist` 错误。
- **操作**: 通过 `prisma db push` 命令强制同步数据库 schema，确保 `User` 表被成功创建。

### 2025-08-19 (Auth & Profile Refactor)

- **架构**: 增加完整的前后端用户认证体系（注册、登录、JWT）。
- **后端**:
  - 新增 `User` 数据模型，并与 `PaiPan` 记录关联。
  - 新增 `/api/auth/register`, `/api/auth/login`, `/api/auth/me` 等认证接口。
  - 增加服务端中间件，自动验证 API 请求的 JWT Token。
  - 改造 `/api/pai-pan` 和 `/api/pai-pan/history` 接口，使其与当前登录用户关联。
- **前端**:
  - 引入 `vant` 作为核心 UI 组件库。
  - 新增登录 (`/auth/login`) 和注册 (`/auth/register`) 页面。
  - 新增 Pinia `authStore`，统一管理用户状态、Token，并封装认证相关接口调用。
  - 新增全局路由中间件，实现客户端的页面访问权限控制。
  - 重构个人中心页 (`/profile`)，显示用户信息、提供功能入口和退出登录。
  - 新增排盘历史页 (`/profile/history`)，用于展示当前用户的所有排盘记录。
- **布局**: 重构默认布局 `layouts/default.vue`，增加只在主页面（首页、我的）显示的底部导航栏。

### 2025-08-19

- **新增**: 基于 Vant UI 增加底部导航栏，包含“首页”、“排盘结果”、“个人中心”三个模块。
- **新增**: 创建“个人中心”页面，提供用户信息展示、历史记录查询入口和退出登录功能。
- **重构**: 调整“排盘结果”页面逻辑，支持通过底部导航查看最新结果，或通过“个人中心”查询历史记录。
- **新增**: 创建共享布局 `layouts/default.vue`，承载全局底部导航。

### 2025-08-19

- **新增**: 在首页增加了农历/公历输入的选项卡，支持用户按农历输入生日。
- **功能**: 后端接口已适配农历输入，可自动转换为公历进行排盘计算。
- **优化**: 结果页的基本信息展示区域已进行压缩，布局更紧凑。
- **优化**: 根据用户反馈，为确保在所有设备上的一致体验，移除了大运和流年模块的所有切换动画特效。数据将进行即时刷新。
- **优化**: 为大运横向滚动容器保留了 `scroll-behavior: smooth` 样式，以提升手动滚动体验。
- **优化**: 自动将当前所在的大运卡片滚动至容器中央，方便用户查看。
- **优化**: 调整了当前流年卡片的背景渐变色，改为从左上（天干）到右下（地支）的颜色过渡，并应用 20%的透明度。
- **新增**: 排盘结果中增加农历和公历日期的完整显示。
- **功能**: 根据当前北京时间，自动高亮所在的大运卡片。
- **功能**: 为当前流年卡片增加从天干到地支五行颜色的渐变背景，使其更醒目。
- **重构**: 后端大运和流年算法统一采用 `lunar-javascript` 库，提高了数据的准确性，并统一了前后端数据模型。

### 2025-08-20

- **优化**: 调整了四柱中“日主”的文字样式，背景色改为从日柱天干五行颜色到地支五行颜色的左上至右下渐变。
- **新增**: 在流年信息卡片中，明确展示了每个流年对应的公历年份，方便用户溯查。

- 2024-08-19: **重构**大运流年组件，解决切换时 active 样式延迟问题。**优化**加载体验，使用与内容等高的骨架屏（Skeleton）代替原 loading 图标，避免了数据加载前后的页面闪烁。

- 2024-08-19: 优化结果页大运流年切换性能，解决点击卡顿问题，增加 loading 状态。
